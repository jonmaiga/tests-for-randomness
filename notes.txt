TODO:
-----
- splits are not good see if it can be avoided.
- use meta? show 3 meta + 3 sample results?
- use trng to see if we can get evaluate_multi_pass working from 2^4 ? 
- Select maximize or minimize in sffs.
- Determine false positive rate
- Splits are added many times if same result formatter is used when n increases (see e.g. kendall_tau).
- Speed up tests, bad CPU utilization atm, this should done in the jobs, keeping X threads, jumping between job queues.
	- for now just increasing sffs threads works (but probably has a ton of overhead)
- ww, coupons at k=0 hangs...
- lgamma is not thread safe

DONE:
-----
- permutation is sensitive to too manu bins - meta analysis gets no p-values close to 0.5.
	- split? <-- fixes it
- investigate how far each individual test goes.
- correlation/kendall tau should only be checked on one side like ztest?
- bc3d trng fails. "fixed" by using at least 25 expected per bin
- inspect tests: ww fails after bug fix. (added semiugly exception)
- permutation trng fails (64bit, trng seed 301071360, 2^20), (32-bit, trngs seed 602142720, 2^20/21: C:\tmp\random.org\raw\random.org-pregenerated-2012-11-bin\2012-11-30.bin) 
	* rescale histo to 0-1 is too discrete for chi2/ad/ks
	* Test histogram in mma, finds uniform discrete, fail has 1200 std dev passing has 600
	* ks+ad "always passes" when rescaled data to 0-1
	* Not sure why, test with split chi2, ks and ad?
	* REASON: chi square is sensitive for large sample sizes - solution is to use more bins.
- fix formatting of suspicous streams (should be in value column)
- testable: mixers, combiners, hashers, prngs
- add sanity tests
- self-inspect tests?
- which tests are two sided? ww? z-test should only look on values close to zero. z-score only checks near 0
- combiner with 0, 0 constant streams shows that many tests are inconclusive still the meta interpretation passes.
  * fixed problem with coupon,gap and divisibility solved it.
- Show biggest offenders in tests result.
- Not necessary: Possible to seed all tests at startup (counter1 makes no sense only for trng or mixed data)
- Make it work with large n
	* need to run some tests multiple times (kendall and all that requires sorting etc)
	* need to be able to continue a stream
- Pass in cmd line args for trng file
- Proper tags instead of string contains in query
  Simple fix is to have exact match for mixer names. Lets see how far it goes.
- does divisibility work as it should? Or too few data points??
	- bit-isolation fails trng with d3:
		Using 16640 samples per test, each with 10000 data points.
		test             trng1       mx3          nasam       xmxmx       moremur      lea64        degski64   splitmix     murmur3    xmx
		divisibility-d2  P (169)     F*(171)      P (179)     P (151)     P (199)      P (169)      P (197)    P (191)      P (197)    F*(16617)
		divisibility-d3  F*(214)     P (187)      F*(256)     P (209)     P (226)      P (227)      P (187)    P (218)      P (198)    F*(11125)
		kolmogorov_d     0.00182935  0.000238291  0.0493007   0.00108469  0.0205633    0.000619493  0.0157931  0.0123172    0.232204   0
		anderson_a2      0.994346    0.999978     0.996995    0.999219    0.99981      0.999902     0.994976   0.997893     0.981366   1
		chi2             0.00244941  0.00051067   5.8374e-05  0.311584    3.19588e-07  0.0072541    0.155593   2.15719e-05  0.0774099  0
		fails            383         358          435         360         425          396          384        409          395        27742
	- have potential fixed commited, test it
- Power of two tests
- Incremental tests
	(keep stream state and emit results along the way, will halfen the required cpu time)
	(basic - sum of squares need to be completely reevaluated)
	(sac, bic - state can continue)
	(chi2 - more data more bins - needs recompute)
	(overall it seems like additional complexity doesn't make it worth while)
	NOT FEASIBLE
- should mean test be two sided (sample mean == population mean => 1)
	test subject     mx3             
	2^k              21              
	samples          256             
	mean-m           failure (5)
	Extracted means, worst offenders where type I mma had same result for individual rrcs and same meta_analysis.
- Trng should not have to lock? Instead use seeded mx3 to extract values
- add prng testing
- What is a good fitness function. Design an experiment: 
	- which streams should be used = counter1 + rrc
		(rrc, bit-isolation, sources: (trng?, mixed, counter1, ?))
	- which tests should be used
		tests are documented with comment.
		(remove redundant/correlated tests)
	- how many datapoints per test should be used 
		multi-pass until failure.
		(preliminary minimum 5k-10k while 100k seems stable in terms of fails)
	- which fitness function works best? minimize kolmogorov, chi2, ad? all? count fails?
		max_power-failure_power + ks.
		(preliminary pretty much same-same it seems, but minimizing it might not be what we want (too regular?))
		(maybe optimize on outliers?)
		(probably how far it survives the tests, pract-rand style!)


OTHER:
------
// not sure what to do with variance, can't get p values uniformly distributed.
// https://www.youtube.com/watch?v=V4Rm4UQHij0 sampling dist of variance is not normal!
// We can't use this for variance since it's sampling is non normal!
// https://stats.stackexchange.com/questions/121662/why-is-the-sampling-distribution-of-variance-a-chi-squared-distribution
//constexpr auto pop_var = 1. / 12.;
//const auto var_x2 = (n - 1) * stats.variance / pop_var;
//const auto p_value = chi2_distribution_normal_approximation_cdf(var_x2, n - 1);
//const auto p_value = f_test(stats.n, stats.variance, population_variance);
//const auto pop_var_var = 2 * pop_var * pop_var / (n - 1);
//const auto p_value = z_test(stats.n, stats.variance, pop_var, pop_var_var);

Tried sffs over jenkins came to 2^12 ish. Not worth it. (see jenkins-config branch)
Tried sffs over xxmxx with different variations. Not worth it.
Divisible test seems very weak.
Tested bit matrix, very weak.


==========================================================================================
xm3x 2^27 with 128 samples using 32-bits.
==========================================================================================
test       p-value      remark       stream/description
uniform-m  7.34232e-27  failure(10)  meta analysis over 128 samples
bic-m      2.19467e-25  failure(10)  meta analysis over 128 samples
sac-m      8.01611e-11  failure(10)  meta analysis over 128 samples

***FAILED*** at 2^27 with a total of 3 failures and 0 suspicious results.

==========================================================================================
mx3 2^26 with 128 samples using 32-bits.
==========================================================================================
test       p-value     remark      stream/description
uniform-m  5.6372e-10  failure(9)  meta analysis over 128 samples

***FAILED*** at 2^26 with a total of 1 failures and 0 suspicious results.
==========================================================================================
mx3 2^27 with 128 samples using 32-bits.
==========================================================================================
test       p-value      remark       stream/description
uniform-m  6.58793e-33  failure(10)  meta analysis over 128 samples
bic-m      2.12371e-18  failure(10)  meta analysis over 128 samples

***FAILED*** at 2^27 with a total of 2 failures and 0 suspicious results.

==========================================================================================
xm2x 2^17 with 128 samples using 32-bits.
==========================================================================================
test       p-value      remark         stream/description
uniform-m  2.11782e-11  failure(10)    xm2x(reverse-29(counter-1))
sac-m      4.37924e-07  suspicious(6)  meta analysis over 128 samples
bic-m      6.3598e-06   suspicious(5)  meta analysis over 128 samples

***FAILED*** at 2^17 with a total of 1 failures and 2 suspicious results.


TRNG p-value uniform:
2^20
bc2d-bit(5)      suspicious(6) (p=4.91204e-07) p-value uniformity

2^24
permutation-m  failure(10) (p=1.28603e-16) p-value uniformity

2^29 (may spin around)
uniform-m      failure(10) (p=3.77766e-22) p-value uniformity
gap-g1         suspicious(6) (p=1.81138e-07) p-value uniformity

2^30 (may spin around)
mean-m         failure(9) (p=5.08189e-10) p-value uniformity

Executing command -test
==========================================================================================
rdrand 2^20 with 128 samples using 32-bits.
==========================================================================================
test             p-value      failure-strength  stream/description
bc3d-bit(13,24)  7.12808e-12  failure(10)       meta analysis over 128 samples
bc3d-bit(19,8)   2.75242e-11  failure(10)       meta analysis over 128 samples
bc3d-bit(11,9)   3.49372e-11  failure(10)       meta analysis over 128 samples

***FAILED*** at 2^20 with a total of 3 failures and 17 suspicious results.

==========================================================================================
rdrand 2^21 with 128 samples using 32-bits.
==========================================================================================
test            p-value      failure-strength  stream/description
bc3d-bit(17,7)  2.81951e-14  failure(10)       meta analysis over 128 samples
bc3d-bit(9,10)  6.4145e-12   failure(10)       meta analysis over 128 samples
bc3d-bit(7,17)  8.58904e-11  failure(10)       meta analysis over 128 samples

***FAILED*** at 2^21 with a total of 5 failures and 15 suspicious results.

==========================================================================================
rdrand 2^22 with 128 samples using 32-bits.
==========================================================================================
test             p-value      failure-strength    stream/description
bc3d-bit(8,21)   3.49538e-08  very suspicious(7)  meta analysis over 128 samples
bc3d-bit(10,23)  1.07998e-07  suspicious(6)       meta analysis over 128 samples
bc3d-bit(8,11)   5.25851e-07  suspicious(6)       meta analysis over 128 samples

PASSED 2^22 with a total of 0 failures and 8 suspicious results.

DRNG:
==========================================================================================
trng 2^24 with 128 samples using 32-bits.
==========================================================================================
test            p-value      failure-strength    stream/description
bc3d-bit(7,22)  1.05343e-10  failure(9)          meta analysis over 128 samples
bc3d-bit(10,7)  2.52485e-08  very suspicious(7)  meta analysis over 128 samples
bc3d-bit(13,6)  7.44488e-08  very suspicious(7)  meta analysis over 128 samples

***FAILED*** at 2^24 with a total of 1 failures and 18 suspicious results.

==========================================================================================
trng 2^25 with 128 samples using 32-bits.
==========================================================================================
test             p-value      failure-strength    stream/description
bc3d-bit(27,15)  3.77851e-15  failure(10)         meta analysis over 128 samples
bc3d-bit(27,17)  5.59138e-14  failure(10)         meta analysis over 128 samples
bc3d-bit(17,5)   2.90128e-11  failure(10)         meta analysis over 128 samples
permutation-m    9.26749e-08  very suspicious(7)  meta analysis over 128 samples
bc2d-bit(3)      1.0663e-06   suspicious(5)       meta analysis over 128 samples
bc2d-bit(8)      4.04683e-06  suspicious(5)       meta analysis over 128 samples

***FAILED*** at 2^25 with a total of 6 failures and 22 suspicious results.

==========================================================================================
trng 2^26 with 128 samples using 32-bits.
==========================================================================================
test            p-value      failure-strength    stream/description
bc3d-bit(7,23)  5.5059e-12   failure(10)         meta analysis over 128 samples
bc3d-bit(7,9)   3.97865e-11  failure(10)         meta analysis over 128 samples
bc3d-bit(6,22)  2.89074e-10  failure(9)          meta analysis over 128 samples
bc2d-bit(8)     1.03483e-08  very suspicious(7)  meta analysis over 128 samples
bc2d-bit(20)    4.58711e-08  very suspicious(7)  meta analysis over 128 samples
permutation-m   3.25524e-07  suspicious(6)       meta analysis over 128 samples
bc2d-bit(17)    1.65811e-06  suspicious(5)       meta analysis over 128 samples

***FAILED*** at 2^26 with a total of 6 failures and 23 suspicious results.

==========================================================================================
trng 2^27 with 128 samples using 32-bits.
==========================================================================================
test             p-value      failure-strength  stream/description
bc2d-bit(8)      3.02805e-22  failure(10)       meta analysis over 128 samples
bc3d-bit(8,25)   5.11296e-16  failure(10)       meta analysis over 128 samples
bc3d-bit(7,23)   5.54483e-16  failure(10)       meta analysis over 128 samples
bc3d-bit(25,22)  1.77229e-14  failure(10)       meta analysis over 128 samples
permutation-m    1.6407e-12   failure(10)       meta analysis over 128 samples
bc2d-bit(28)     1.25644e-10  failure(9)        meta analysis over 128 samples
bc2d-bit(15)     1.63084e-10  failure(9)        meta analysis over 128 samples

***FAILED*** at 2^27 with a total of 13 failures and 41 suspicious results.

==========================================================================================
trng 2^28 with 128 samples using 32-bits.
==========================================================================================
test             p-value      failure-strength  stream/description
bc2d-bit(8)      1.58155e-37  failure(10)       meta analysis over 128 samples
permutation-m    9.70474e-31  failure(10)       meta analysis over 128 samples
bc3d-bit(18,21)  1.87822e-25  failure(10)       meta analysis over 128 samples
bc3d-bit(17,25)  3.07374e-22  failure(10)       meta analysis over 128 samples
bc3d-bit(7,9)    2.11476e-21  failure(10)       meta analysis over 128 samples
bc2d-bit(22)     8.59966e-16  failure(10)       meta analysis over 128 samples
bc2d-bit(11)     2.41014e-15  failure(10)       meta analysis over 128 samples

***FAILED*** at 2^28 with a total of 41 failures and 94 suspicious results.

==========================================================================================
trng 2^29 with 128 samples using 32-bits.
==========================================================================================
test             p-value      failure-strength    stream/description
bc3d-bit(7,9)    8.37397e-53  failure(10)         meta analysis over 128 samples
bc3d-bit(18,21)  5.19397e-45  failure(10)         meta analysis over 128 samples
bc2d-bit(16)     2.39794e-37  failure(10)         meta analysis over 128 samples
bc3d-bit(11,24)  4.75533e-36  failure(10)         meta analysis over 128 samples
bc2d-bit(11)     1.75667e-31  failure(10)         meta analysis over 128 samples
bc2d-bit(22)     2.80669e-29  failure(10)         meta analysis over 128 samples
permutation-m    6.22537e-14  failure(10)         meta analysis over 128 samples
divisibility-d2  1.34559e-09  very suspicious(8)  meta analysis over 128 samples
gap-g2           7.666e-09    very suspicious(8)  meta analysis over 128 samples
gap-g1           2.29765e-08  very suspicious(7)  meta analysis over 128 samples

***FAILED*** at 2^29 with a total of 111 failures and 126 suspicious results.



AES:
==========================================================================================
aes 2^24 with 128 samples using 32-bits.
==========================================================================================
test             p-value      failure-strength    stream/description
bc3d-bit(7,22)   1.32906e-13  failure(10)         meta analysis over 128 samples
bc3d-bit(25,22)  3.31667e-08  very suspicious(7)  meta analysis over 128 samples
bc3d-bit(10,25)  5.27121e-08  very suspicious(7)  meta analysis over 128 samples

***FAILED*** at 2^24 with a total of 1 failures and 14 suspicious results.

==========================================================================================
aes 2^25 with 128 samples using 32-bits.
==========================================================================================
test             p-value      failure-strength    stream/description
permutation-m    1.48736e-58  failure(10)         meta analysis over 128 samples
bc2d-bit(3)      7.40687e-12  failure(10)         meta analysis over 128 samples
bc3d-bit(24,24)  2.42735e-11  failure(10)         meta analysis over 128 samples
bc3d-bit(11,26)  4.05491e-10  failure(9)          meta analysis over 128 samples
bc3d-bit(5,15)   8.53038e-10  failure(9)          meta analysis over 128 samples
bc2d-bit(29)     7.12284e-08  very suspicious(7)  meta analysis over 128 samples
permutation-m    1            suspicious(6)       aes

***FAILED*** at 2^25 with a total of 5 failures and 24 suspicious results.

==========================================================================================
aes 2^26 with 128 samples using 32-bits.
==========================================================================================
test             p-value      failure-strength    stream/description
uniform-m        0            failure(10)         aes
permutation-m    0            failure(10)         aes
permutation-m    1.49513e-90  failure(10)         meta analysis over 128 samples
bc3d-bit(26,10)  1.04562e-11  failure(10)         meta analysis over 128 samples
bc3d-bit(23,25)  5.0869e-11   failure(10)         meta analysis over 128 samples
bc3d-bit(22,26)  1.42098e-08  very suspicious(7)  meta analysis over 128 samples
uniform-m        5.15819e-08  very suspicious(7)  meta analysis over 128 samples
bc2d-bit(29)     5.67662e-07  suspicious(6)       meta analysis over 128 samples

***FAILED*** at 2^26 with a total of 5 failures and 20 suspicious results.

With ww fix:
KEY           VALUE
test subject  pcg
2^k           33
samples       128
n per sample  8589934592
-------       -------
ww-s1321      suspicious (5)
ww-s2012      suspicious (5)
ww-s2517      suspicious (5)
ww-s3209      very suspicious (7)
ww-s4279      suspicious (5)
ww-s5483      suspicious (5)
ww-s5947      suspicious (5)
ww-s6580      suspicious (5)
ww-s6926      suspicious (6)
ww-s7910      suspicious (5)
ww-s850       suspicious (5)
-------       -------
SUMMARY       PASS: very suspicious (7)

Executing command -test
KEY                     VALUE
test subject            pcg-1
2^k                     30
samples                 128
n per sample            1073741824
-------                 -------
ww-pcg-3062792213-s850  suspicious (5)
-------                 -------
SUMMARY                 PASS: suspicious (5)


KEY           VALUE
test subject  mt
2^k           29
samples       128
n per sample  536870912
-------       -------
ww-mt-s125    suspicious (5)
-------       -------
SUMMARY       PASS: suspicious (5)


KEY                          VALUE
test subject                 xoshiro128plusplus
2^k                          31
samples                      128
n per sample                 2147483648
-------                      -------
ww-xoshiro128plusplus-s1482  suspicious (5)
ww-xoshiro128plusplus-s1613  suspicious (5)
ww-xoshiro128plusplus-s621   suspicious (5)
-------                      -------
SUMMARY                      PASS: suspicious (5)